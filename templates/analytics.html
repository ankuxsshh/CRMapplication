{% extends 'base.html' %}

{% block title %}Analytics - {{ year }} | Dreamsland Realty{% endblock %}

{% block content %}
<div class="container mx-auto py-2 px-1">
<h1 class="text-3xl font-bold mb-2">Analytics {{ year }}</h1>

  <!-- Flexbox Layout for Left and Right Section -->
  <div class="flex flex-col lg:flex-row gap-8">
    
    <!-- LEFT: One Big Bar Chart -->
    <div class="lg:w-1/3 bg-white p-6 rounded-lg shadow mb-8 lg:mb-0">
      <h2 class="text-xl font-semibold text-gray-700 mb-4 text-center">Total Properties per month </h2>
      <canvas id="yearBarChart" class="w-full h-80"></canvas>
    </div>

    <!-- RIGHT: Individual Monthly Graphs -->
    <div class="lg:w-2/3 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for item in analytics %}
      <div class="bg-white rounded-lg shadow p-4">
        <h3 class="text-lg font-semibold text-center text-gray-700 mb-2">
          {{ item.month|date:"F" }}
        </h3>
        <canvas id="monthChart{{ item.month }}" class="w-full h-64"></canvas>
      </div>
      {% endfor %}
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  const monthLabels = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                       "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

  const totalCounts = [
    {% for item in analytics %}
      {{ item.data.totalCount|default:0 }},
    {% endfor %}
  ];

  new Chart(document.getElementById('yearBarChart'), {
    type: 'bar',
    data: {
      labels: monthLabels,
      datasets: [{
        label: 'Total Properties',
        data: totalCounts,
        backgroundColor: 'rgba(59, 130, 246, 0.7)',
        borderColor: 'rgba(37, 99, 235, 1)',
        borderWidth: 1,
        borderRadius: 6
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true,
          title: {
            display: true,
            text: 'Count'
          }
        }
      }
    }
  });

  {% for item in analytics %}
    const weeklyLabels{{ item.month }} = [
      {% for week in item.data.data %}
        "{{ week.weekRange }}",
      {% endfor %}
    ];
    const weeklyCounts{{ item.month }} = [
      {% for week in item.data.data %}
        {{ week.count }},
      {% endfor %}
    ];

    new Chart(document.getElementById('monthChart{{ item.month }}'), {
      type: 'bar',
      data: {
        labels: weeklyLabels{{ item.month }},
        datasets: [{
          label: 'Weekly Count',
          data: weeklyCounts{{ item.month }},
          backgroundColor: 'rgba(16, 185, 129, 0.7)',
          borderColor: 'rgba(5, 150, 105, 1)',
          borderWidth: 1,
          borderRadius: 5
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false }
        },
        scales: {
          y: {
            beginAtZero: true
          },
          x: {
            ticks: {
              maxRotation: 45,
              minRotation: 45
            }
          }
        }
      }
    });
  {% endfor %}
</script>
{% endblock %}
